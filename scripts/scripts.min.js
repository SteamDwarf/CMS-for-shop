"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.SERVER_URI=exports.API_URI=void 0;var API_URI="https://shop-server-cms.herokuapp.com/api",SERVER_URI=(exports.API_URI=API_URI,"https://shop-server-cms.herokuapp.com/");exports.SERVER_URI=SERVER_URI;
"use strict";var _modalController=require("./controllers/modalController.js"),_elems=require("./elems/elems.js"),_previewController=require("./controllers/previewController.js"),_tableController=require("./controllers/tableController.js"),_formController=require("./controllers/formController.js"),_dataController=require("./controllers/dataController.js"),init=function(){(0,_modalController.modalController)(),(0,_previewController.previewController)(_elems.imageInput),(0,_tableController.tableController)(),(0,_formController.formController)(),(0,_dataController.dataController)()};init();
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.postProduct=exports.getGoods=exports.getCategories=exports.editProductRequest=exports.deleteProductRequest=void 0;var _const=require("../const.js"),_stateManager=_interopRequireDefault(require("../managers/stateManager.js"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var fetchData=function(e){var t=e.url,n=e.loadingFunc,r=e.successFunc,o=e.errorFunc;n&&n(!0),fetch(t).then(function(e){return e.ok?e.json():Promise.reject(e)}).then(function(e){return r(e)}).catch(function(e){return o?o(e):console.error(e)}).finally(function(){return n?n(!1):null})},postData=function(e){var t=e.url,n=e.loadingFunc,r=e.postingData,o=e.successFunc,c=e.errorFunc;n&&n(!0),fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}).then(function(e){return e.ok?e.json():Promise.reject(e)}).then(function(e){return o(e)}).catch(function(e){return c?c(e):console.error(e)}).finally(function(){return n?n(!1):null})},deleteData=function(e,t,n,r){fetch("".concat(e).concat(t),{method:"DELETE"}).then(function(e){return e.ok?e.json():Promise.reject(e)}).then(function(e){return n(e)}).catch(function(e){return r?r(e):console.error(e)})},editData=function(e){var t=e.url,n=e.editedData,r=e.itemID,o=e.loadingFunc,c=e.successFunc,u=e.errorFunc;o&&o(!0),fetch("".concat(t).concat(r),{method:"PATCH",body:JSON.stringify(n)}).then(function(e){return e.ok?e.json():Promise.reject(e)}).then(function(e){return c(e)}).catch(function(e){return u?u(e):console.error(e)}).finally(function(){return o?o(!1):null})},getGoods=function(e){var t=e.loadingFunc,e=e.errorFunc;return fetchData({url:"".concat(_const.API_URI,"/goods?nopage=true"),loadingFunc:t,successFunc:_stateManager.default.allGoods.setValue,errorFunc:e})},getCategories=(exports.getGoods=getGoods,function(e){var t=e.loadingFunc,e=e.errorFunc;return fetchData({url:"".concat(_const.API_URI,"/category"),loadingFunc:t,successFunc:_stateManager.default.categories.setValue,errorFunc:e})}),postProduct=(exports.getCategories=getCategories,function(e){var t=e.data,n=e.loadingFunc,r=e.successFunc,e=e.errorFunc;return postData({url:"".concat(_const.API_URI,"/goods"),postingData:t,loadingFunc:n,successFunc:r,errorFunc:e})}),deleteProductRequest=(exports.postProduct=postProduct,function(e,t,n){return deleteData("".concat(_const.API_URI,"/goods/"),e,t,n)}),editProductRequest=(exports.deleteProductRequest=deleteProductRequest,function(e){var t=e.editedData,n=e.productID,r=e.loadingFunc,o=e.successFunc,e=e.errorFunc;return editData({url:"".concat(_const.API_URI,"/goods/"),editedData:t,itemID:n,loadingFunc:r,successFunc:o,errorFunc:e})});exports.editProductRequest=editProductRequest;
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.dataController=void 0;var _sortController=require("./sortController.js"),_paginationController=require("./paginationController.js"),_filterController=require("./filterController.js"),_stateManager=_interopRequireDefault(require("../managers/stateManager.js")),_utils=require("../utils/utils.js"),_utils2=require("../managers/utils.js");function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var transformList=function(){var t=_stateManager.default.allGoods.getValue(),e=_stateManager.default.visibleGoods,t=(0,_utils.compose)(_paginationController.setPagination,_sortController.sortingData,_filterController.filteringProducts)(t);e.setValue(t)},dataController=function(){var t=_stateManager.default.allGoods,e=_stateManager.default.filter,r=_stateManager.default.sortField,o=_stateManager.default.sortDirection,a=_stateManager.default.curPage;(0,_sortController.sortController)(),(0,_paginationController.paginationController)(),(0,_filterController.filterController)(),(0,_utils2.useEffect)(transformList,[t,e,r,o,a])};exports.dataController=dataController;
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.filteringProducts=exports.filterController=void 0;var _elems=require("../elems/elems.js"),_stateManager=_interopRequireDefault(require("../managers/stateManager.js"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var changeFilter=function(e){e=e.target;_stateManager.default.filter.setValue(e.value)},filteringProducts=function(e){var t=_stateManager.default.filter.getValue();return e.filter(function(e){return[e.id,e.title,e.category,e.price.toString()].some(function(e){return e.toLowerCase().includes(t.toLowerCase())})})},filterController=(exports.filteringProducts=filteringProducts,function(){_elems.filterInput.addEventListener("input",changeFilter)});exports.filterController=filterController;
"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.formController=void 0;var _serviceAPI=require("../API/serviceAPI.js"),_elems=require("../elems/elems.js"),_utils=require("../utils/utils.js"),_formView=require("../view/formView.js"),_stateManager=_interopRequireDefault(require("../managers/stateManager.js")),_triggerManager=_interopRequireDefault(require("../managers/triggerManager.js")),_utils2=require("../managers/utils.js");function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function _regeneratorRuntime(){_regeneratorRuntime=function(){return i};var i={},t=Object.prototype,c=t.hasOwnProperty,e="function"==typeof Symbol?Symbol:{},n=e.iterator||"@@iterator",r=e.asyncIterator||"@@asyncIterator",o=e.toStringTag||"@@toStringTag";function a(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{a({},"")}catch(t){a=function(t,e,r){return t[e]=r}}function u(t,e,r,n){var o,a,i,u,e=e&&e.prototype instanceof f?e:f,e=Object.create(e.prototype),n=new b(n||[]);return e._invoke=(o=t,a=r,i=n,u="suspendedStart",function(t,e){if("executing"===u)throw new Error("Generator is already running");if("completed"===u){if("throw"===t)throw e;return x()}for(i.method=t,i.arg=e;;){var r=i.delegate;if(r){r=function t(e,r){var n=e.iterator[r.method];if(void 0===n){if(r.delegate=null,"throw"===r.method){if(e.iterator.return&&(r.method="return",r.arg=void 0,t(e,r),"throw"===r.method))return l;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}n=s(n,e.iterator,r.arg);if("throw"===n.type)return r.method="throw",r.arg=n.arg,r.delegate=null,l;n=n.arg;return n?n.done?(r[e.resultName]=n.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,l):n:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,l)}(r,i);if(r){if(r===l)continue;return r}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if("suspendedStart"===u)throw u="completed",i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);u="executing";r=s(o,a,i);if("normal"===r.type){if(u=i.done?"completed":"suspendedYield",r.arg===l)continue;return{value:r.arg,done:i.done}}"throw"===r.type&&(u="completed",i.method="throw",i.arg=r.arg)}}),e}function s(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}i.wrap=u;var l={};function f(){}function h(){}function d(){}var e={},y=(a(e,n,function(){return this}),Object.getPrototypeOf),y=y&&y(y(w([]))),p=(y&&y!==t&&c.call(y,n)&&(e=y),d.prototype=f.prototype=Object.create(e));function m(t){["next","throw","return"].forEach(function(e){a(t,e,function(t){return this._invoke(e,t)})})}function g(i,u){var e;this._invoke=function(r,n){function t(){return new u(function(t,e){!function e(t,r,n,o){var a,t=s(i[t],i,r);if("throw"!==t.type)return(r=(a=t.arg).value)&&"object"==_typeof(r)&&c.call(r,"__await")?u.resolve(r.__await).then(function(t){e("next",t,n,o)},function(t){e("throw",t,n,o)}):u.resolve(r).then(function(t){a.value=t,n(a)},function(t){return e("throw",t,n,o)});o(t.arg)}(r,n,t,e)})}return e=e?e.then(t,t):t()}}function v(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function _(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function b(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(v,this),this.reset(!0)}function w(e){if(e){var r,t=e[n];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length))return r=-1,(t=function t(){for(;++r<e.length;)if(c.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t}).next=t}return{next:x}}function x(){return{value:void 0,done:!0}}return a(p,"constructor",h.prototype=d),a(d,"constructor",h),h.displayName=a(d,o,"GeneratorFunction"),i.isGeneratorFunction=function(t){t="function"==typeof t&&t.constructor;return!!t&&(t===h||"GeneratorFunction"===(t.displayName||t.name))},i.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,d):(t.__proto__=d,a(t,o,"GeneratorFunction")),t.prototype=Object.create(p),t},i.awrap=function(t){return{__await:t}},m(g.prototype),a(g.prototype,r,function(){return this}),i.AsyncIterator=g,i.async=function(t,e,r,n,o){void 0===o&&(o=Promise);var a=new g(u(t,e,r,n),o);return i.isGeneratorFunction(e)?a:a.next().then(function(t){return t.done?t.value:a.next()})},m(p),a(p,o,"Generator"),a(p,n,function(){return this}),a(p,"toString",function(){return"[object Generator]"}),i.keys=function(r){var t,n=[];for(t in r)n.push(t);return n.reverse(),function t(){for(;n.length;){var e=n.pop();if(e in r)return t.value=e,t.done=!1,t}return t.done=!0,t}},i.values=w,b.prototype={constructor:b,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(_),!t)for(var e in this)"t"===e.charAt(0)&&c.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(r){if(this.done)throw r;var n=this;function t(t,e){return a.type="throw",a.arg=r,n.next=t,e&&(n.method="next",n.arg=void 0),!!e}for(var e=this.tryEntries.length-1;0<=e;--e){var o=this.tryEntries[e],a=o.completion;if("root"===o.tryLoc)return t("end");if(o.tryLoc<=this.prev){var i=c.call(o,"catchLoc"),u=c.call(o,"finallyLoc");if(i&&u){if(this.prev<o.catchLoc)return t(o.catchLoc,!0);if(this.prev<o.finallyLoc)return t(o.finallyLoc)}else if(i){if(this.prev<o.catchLoc)return t(o.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return t(o.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;0<=r;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&c.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}var a=(o=o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc?null:o)?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,l):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),l},finish:function(t){for(var e=this.tryEntries.length-1;0<=e;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),_(r),l}},catch:function(t){for(var e=this.tryEntries.length-1;0<=e;--e){var r,n,o=this.tryEntries[e];if(o.tryLoc===t)return"throw"===(r=o.completion).type&&(n=r.arg,_(o)),n}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:w(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},i}function _slicedToArray(t,e){return _arrayWithHoles(t)||_iterableToArrayLimit(t,e)||_unsupportedIterableToArray(t,e)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,a=[],i=!0,u=!1;try{for(r=r.call(t);!(i=(n=r.next()).done)&&(a.push(n.value),!e||a.length!==e);i=!0);}catch(t){u=!0,o=t}finally{try{i||null==r.return||r.return()}finally{if(u)throw o}}return a}}function _arrayWithHoles(t){if(Array.isArray(t))return t}function asyncGeneratorStep(t,e,r,n,o,a,i){try{var u=t[a](i),c=u.value}catch(t){return void r(t)}u.done?e(c):Promise.resolve(c).then(n,o)}function _asyncToGenerator(u){return function(){var t=this,i=arguments;return new Promise(function(e,r){var n=u.apply(t,i);function o(t){asyncGeneratorStep(n,e,r,o,a,"next",t)}function a(t){asyncGeneratorStep(n,e,r,o,a,"throw",t)}o(void 0)})}}function _toConsumableArray(t){return _arrayWithoutHoles(t)||_iterableToArray(t)||_unsupportedIterableToArray(t)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(t,e){if(t){if("string"==typeof t)return _arrayLikeToArray(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Map"===(r="Object"===r&&t.constructor?t.constructor.name:r)||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(t,e):void 0}}function _iterableToArray(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}function _arrayWithoutHoles(t){if(Array.isArray(t))return _arrayLikeToArray(t)}function _arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var addNewCategory=function(e){var t=_stateManager.default.categories.getValue();return t.some(function(t){return t===e})?t:[].concat(_toConsumableArray(t),[e])},succesFormSubmit=function(t){var e=_stateManager.default.categories,r=_triggerManager.default.closingModal;e.setValue(addNewCategory(t.category)),r.trigger()},successPatchProduct=function(t){var e=_stateManager.default.allGoods,r=_stateManager.default.editableProduct;e.changeItem(t),r.setValue(null),succesFormSubmit(t)},successPostProduct=function(t){_stateManager.default.allGoods.addNewItem(t),succesFormSubmit(t)},addNewProduct=function(){var e=_asyncToGenerator(_regeneratorRuntime().mark(function t(e){var r,o,n;return _regeneratorRuntime().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e.preventDefault(),r=_toConsumableArray(new FormData(_elems.modalForm)),o={},n=_stateManager.default.editableProduct,r.forEach(function(){var e=_asyncToGenerator(_regeneratorRuntime().mark(function t(e){var r,n;return _regeneratorRuntime().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:n=_slicedToArray(e,2),r=n[0],n=n[1],r&&(o[r]=n);case 2:case"end":return t.stop()}},t)}));return function(t){return e.apply(this,arguments)}}()),o.image.size)return t.next=8,(0,_utils.toBase64)(o.image);t.next=11;break;case 8:o.image=t.sent,t.next=12;break;case 11:delete o.image;case 12:if(!n.getValue()){t.next=16;break}(0,_serviceAPI.editProductRequest)({editedData:o,productID:o.id,loadingFunc:_formView.sendingRequest,successFunc:successPatchProduct,errorFunc:_formView.renderFormError}),t.next=20;break;case 16:if(o.image){t.next=19;break}return alert("Добавьте изображение"),t.abrupt("return");case 19:(0,_serviceAPI.postProduct)({data:o,loadingFunc:_formView.sendingRequest,successFunc:successPostProduct,errorFunc:_formView.renderFormError});case 20:case"end":return t.stop()}},t)}));return function(t){return e.apply(this,arguments)}}(),clearForm=function(){_elems.modalForm.reset(),_elems.formErrorContainer.innerHTML="",_stateManager.default.editableProduct.setValue(null)},formController=function(){(0,_serviceAPI.getCategories)({}),(0,_formView.initForm)(),(0,_utils2.useEffect)(clearForm,[_triggerManager.default.closingModal]),_elems.modalForm.addEventListener("submit",addNewProduct)};exports.formController=formController;
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.modalController=exports.closeModal=void 0;var _elems=require("../elems/elems.js"),_triggerManager=_interopRequireDefault(require("../managers/triggerManager.js")),_utils=require("../managers/utils.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var openModal=function(){return _elems.modal.classList.add("d-block")},closeModal=function(){_elems.modal.classList.remove("d-block")},modalController=(exports.closeModal=closeModal,function(){var e=_triggerManager.default.openCreatingProduct,r=_triggerManager.default.openEditingProduct,l=_triggerManager.default.closingModal;(0,_utils.useEffect)(openModal,[e,r]),(0,_utils.useEffect)(closeModal,[l]),_elems.creatingProductBtn.addEventListener("click",e.trigger),_elems.modal.addEventListener("click",function(e){e.target!==_elems.modal&&e.target!==_elems.modalCloseBtn||l.trigger()})});exports.modalController=modalController;
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.setPagination=exports.paginationController=void 0;var _elems=require("../elems/elems.js"),_stateManager=_interopRequireDefault(require("../managers/stateManager.js")),_utils=require("../managers/utils.js"),_paginationView=require("../view/paginationView.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var countPages=function(e){var a=_stateManager.default.itemsPerPage.getValue();return Math.ceil(e.length/a)},setPagination=function(e){var a=_stateManager.default.pages,t=_stateManager.default.curPage.getValue(),n=_stateManager.default.itemsPerPage.getValue(),r=countPages(e),i=(t-1)*n,t=t*n;return r!==a.getValue()&&a.setValue(r),e.slice(i,t)},resetPage=(exports.setPagination=setPagination,function(){var e=_elems.pagesContainer.querySelector(".page-btn");_stateManager.default.curPage.setValue(1),e&&(0,_paginationView.changePage)(e)}),paginationController=function(){var e=_stateManager.default.pages,a=_stateManager.default.filter;(0,_utils.useEffect)(_paginationView.renderPagesButtons,[e]),(0,_utils.useEffect)(resetPage,[a])};exports.paginationController=paginationController;
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.showPreview=exports.previewController=void 0;var _utils=require("../utils/utils.js"),_elems=require("../elems/elems.js"),_triggerManager=_interopRequireDefault(require("../managers/triggerManager.js")),_utils2=require("../managers/utils.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var showPreview=function(e){_elems.preview.classList.add("d-block"),e.type?(0,_utils.toBase64)(e).then(function(e){return _elems.preview.src=e}).catch(function(e){return console.error(e)}):_elems.preview.src=e},hidePreview=(exports.showPreview=showPreview,function(){_elems.preview.removeAttribute("src"),_elems.preview.classList.remove("d-block")}),previewController=function(e){var r=_triggerManager.default.closingModal;(0,_utils2.useEffect)(hidePreview,[r]),e.addEventListener("change",function(){e.files[0]&&showPreview(e.files[0],_elems.preview)})};exports.previewController=previewController;
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.sortingData=exports.sortController=void 0;var _elems=require("../elems/elems.js"),_stateManager=_interopRequireDefault(require("../managers/stateManager.js"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var toggleSortDirection=function(){var e=_stateManager.default.sortDirection;"up"===e.getValue()?e.setValue("down"):"down"===e.getValue()&&e.setValue("up")},changeSortSettings=function(e){var e=e.target,t=_stateManager.default.sortField,r=_stateManager.default.sortDirection,e=e.dataset.sort;e&&(t.getValue()===e?toggleSortDirection():("up"!==r.getValue()&&r.setValue("up"),t.setValue(e)))},sortingNumbers=function(e,r){return e.sort(function(e,t){return e[r]-t[r]})},sortingStrings=function(e,r){return e.sort(function(e,t){return e[r].localeCompare(t[r])})},sortingData=function(e){var t=_stateManager.default.sortField.getValue(),r=_stateManager.default.sortDirection.getValue(),o=[];return"id"!==t&&"price"!==t||(o=sortingNumbers(e,t)),"title"!==t&&"category"!==t||(o=sortingStrings(e,t)),"down"===r&&o.reverse(),o},sortController=(exports.sortingData=sortingData,function(){_elems.wrapperSort.addEventListener("click",changeSortSettings)});exports.sortController=sortController;
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.tableController=exports.deleteProduct=exports.chooseProductItem=void 0;var _serviceAPI=require("../API/serviceAPI.js"),_tableView=require("../view/tableView.js"),_stateManager=_interopRequireDefault(require("../managers/stateManager.js")),_triggerManager=_interopRequireDefault(require("../managers/triggerManager.js"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var deleteProduct=function(e){var t=e.dataset.id,r=_stateManager.default.allGoods;(0,_serviceAPI.deleteProductRequest)(t,function(){return r.deleteItem(t)})},chooseProductItem=(exports.deleteProduct=deleteProduct,function(e){var t=e.target,e=_stateManager.default.editableProduct,r=_stateManager.default.visibleGoods;t.closest(".btn-delete")||(e.setValue(r.getValue().find(function(e){return e.id===t.closest(".table-goods-item").dataset.id})),_triggerManager.default.openEditingProduct.trigger())}),tableController=(exports.chooseProductItem=chooseProductItem,function(){(0,_serviceAPI.getGoods)({loadingFunc:_tableView.sendingRequestTable,errorFunc:_tableView.renderErrorMessage}),(0,_tableView.initTable)()});exports.tableController=tableController;
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.wrapperSort=exports.tableSpinner=exports.tableGoodsContainer=exports.tableErrorContainer=exports.previewWrapper=exports.preview=exports.pagesContainer=exports.modalForm=exports.modalCloseBtn=exports.modal=exports.imageInput=exports.formTitle=exports.formSpinner=exports.formErrorContainer=exports.formBtn=exports.filterInput=exports.creatingProductBtn=exports.categoryDataList=void 0;var creatingProductBtn=document.querySelector(".modal-open-btn"),modal=(exports.creatingProductBtn=creatingProductBtn,document.querySelector(".modal")),modalCloseBtn=(exports.modal=modal,document.querySelector(".btn-close")),modalForm=(exports.modalCloseBtn=modalCloseBtn,document.querySelector(".modal-content")),formTitle=(exports.modalForm=modalForm,document.querySelector(".modal-title")),formBtn=(exports.formTitle=formTitle,document.querySelector(".modal-submit-btn")),previewWrapper=(exports.formBtn=formBtn,document.querySelector(".wrapper-preview")),preview=(exports.previewWrapper=previewWrapper,document.querySelector(".preview")),imageInput=(exports.preview=preview,modalForm.image),categoryDataList=(exports.imageInput=imageInput,document.querySelector("#category")),formErrorContainer=(exports.categoryDataList=categoryDataList,document.querySelector(".form-error-conatiner")),formSpinner=(exports.formErrorContainer=formErrorContainer,document.querySelector(".form-spinner")),tableGoodsContainer=(exports.formSpinner=formSpinner,document.querySelector(".table-goods")),tableErrorContainer=(exports.tableGoodsContainer=tableGoodsContainer,document.querySelector(".table-error-container")),tableSpinner=(exports.tableErrorContainer=tableErrorContainer,document.querySelector(".table-spinner")),wrapperSort=(exports.tableSpinner=tableSpinner,document.querySelector(".wrapper-sort")),pagesContainer=(exports.wrapperSort=wrapperSort,document.querySelector(".pagination")),filterInput=(exports.pagesContainer=pagesContainer,document.querySelector(".filter-input"));exports.filterInput=filterInput;
"use strict";function _toConsumableArray(r){return _arrayWithoutHoles(r)||_iterableToArray(r)||_unsupportedIterableToArray(r)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(r,t){if(r){if("string"==typeof r)return _arrayLikeToArray(r,t);var e=Object.prototype.toString.call(r).slice(8,-1);return"Map"===(e="Object"===e&&r.constructor?r.constructor.name:e)||"Set"===e?Array.from(r):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?_arrayLikeToArray(r,t):void 0}}function _iterableToArray(r){if("undefined"!=typeof Symbol&&null!=r[Symbol.iterator]||null!=r["@@iterator"])return Array.from(r)}function _arrayWithoutHoles(r){if(Array.isArray(r))return _arrayLikeToArray(r)}function _arrayLikeToArray(r,t){(null==t||t>r.length)&&(t=r.length);for(var e=0,n=new Array(t);e<t;e++)n[e]=r[e];return n}Object.defineProperty(exports,"__esModule",{value:!0}),exports.createListState=void 0;var createListState=function(){function e(r){n!==r&&(n=r,t.forEach(function(r){return r(n)}))}var n=[],t=[];return{subscribe:function(r){t.push(r)},setValue:e,addNewItem:function(r){e([].concat(_toConsumableArray(n),[r]))},changeItem:function(t){var r=n.filter(function(r){return r.id!==t.id});e([].concat(_toConsumableArray(r),[t]))},deleteItem:function(t){e(n.filter(function(r){return r.id!==t}))},getValue:function(){return n}}};exports.createListState=createListState;
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.createState=void 0;var createState=function(e){var t=e,r=[];return{subscribe:function(e){r.push(e)},setValue:function(e){t!==e&&(t=e,r.forEach(function(e){return e(t)}))},getValue:function(){return t}}};exports.createState=createState;
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _listState=require("./listState.js"),_state=require("./state.js"),stateManager={allGoods:(0,_listState.createListState)(),visibleGoods:(0,_listState.createListState)(),categories:(0,_state.createState)([]),editableProduct:(0,_state.createState)(null),sortField:(0,_state.createState)("id"),sortDirection:(0,_state.createState)("up"),itemsPerPage:(0,_state.createState)(15),pages:(0,_state.createState)(0),curPage:(0,_state.createState)(1),filter:(0,_state.createState)("")},_default=stateManager;exports.default=_default;
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.createTrigger=void 0;var createTrigger=function(){var e=[];return{subscribe:function(r){e.push(r)},trigger:function(){e.forEach(function(r){return r()})}}};exports.createTrigger=createTrigger;
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _trigger=require("./trigger.js"),triggerManager={closingModal:(0,_trigger.createTrigger)(),openCreatingProduct:(0,_trigger.createTrigger)(),openEditingProduct:(0,_trigger.createTrigger)()},_default=triggerManager;exports.default=_default;
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.useEffect=void 0;var useEffect=function(t,e){return e.forEach(function(e){return e.subscribe(t)})};exports.useEffect=useEffect;
"use strict";function _toConsumableArray(r){return _arrayWithoutHoles(r)||_iterableToArray(r)||_unsupportedIterableToArray(r)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(r,e){if(r){if("string"==typeof r)return _arrayLikeToArray(r,e);var t=Object.prototype.toString.call(r).slice(8,-1);return"Map"===(t="Object"===t&&r.constructor?r.constructor.name:t)||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(r,e):void 0}}function _iterableToArray(r){if("undefined"!=typeof Symbol&&null!=r[Symbol.iterator]||null!=r["@@iterator"])return Array.from(r)}function _arrayWithoutHoles(r){if(Array.isArray(r))return _arrayLikeToArray(r)}function _arrayLikeToArray(r,e){(null==e||e>r.length)&&(e=r.length);for(var t=0,o=new Array(e);t<e;t++)o[t]=r[t];return o}Object.defineProperty(exports,"__esModule",{value:!0}),exports.toBase64=exports.currencyFormatRUB=exports.compose=void 0;var toBase64=function(o){return new Promise(function(r,e){var t=new FileReader;t.addEventListener("loadend",function(){return r(t.result)}),t.addEventListener("error",function(){return e(t.error)}),t.readAsDataURL(o)})},currencyFormatRUB=(exports.toBase64=toBase64,function(r){return new Intl.NumberFormat("ru-RU",{style:"currency",currency:"RUB",maximumFractionDigits:0}).format(r)}),compose=(exports.currencyFormatRUB=currencyFormatRUB,function(){for(var r=arguments.length,o=new Array(r),e=0;e<r;e++)o[e]=arguments[e];return function(){for(var r=arguments.length,e=new Array(r),t=0;t<r;t++)e[t]=arguments[t];return o.reduceRight(function(r,e){return[e.call.apply(e,[null].concat(_toConsumableArray(r)))]},e)[0]}});exports.compose=compose;
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.sendingRequest=exports.renderFormError=exports.renderCategory=exports.initForm=void 0;var _elems=require("../elems/elems.js"),_stateManager=_interopRequireDefault(require("../managers/stateManager.js")),_triggerManager=_interopRequireDefault(require("../managers/triggerManager.js")),_previewController=require("../controllers/previewController.js"),_const=require("../const.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var initCreatingForm=function(){_elems.formTitle.textContent="Добавить новый товар",_elems.formBtn.textContent="Добавить товар"},initEditingForm=function(){var e=_stateManager.default.editableProduct.getValue();_elems.formTitle.textContent="Изменить товар",_elems.formBtn.textContent="Изменить товар",_elems.modalForm.id.value=e.id,_elems.modalForm.title.value=e.title,_elems.modalForm.category.value=e.category,_elems.modalForm.description.value=e.description,_elems.modalForm.display.value=e.display,_elems.modalForm.price.value=e.price,_elems.modalForm.imagesave.value=e.image,(0,_previewController.showPreview)("".concat(_const.SERVER_URI).concat(e.image))},renderCategory=function(e){var r=document.createElement("option");r.value=e,_elems.categoryDataList.append(r)},renderCategoryOptions=(exports.renderCategory=renderCategory,function(e){_elems.categoryDataList.innerHTML="",e.forEach(function(e){return renderCategory(e)})}),renderFormError=function(e){_elems.formErrorContainer.innerHTML='\n        <div class="alert alert-danger w-100 text-center" role="alert">\n            <b>'.concat(e.status,":</b> ").concat(e.statusText,"\n        </div>\n    ")},sendingRequest=(exports.renderFormError=renderFormError,function(e){e?(_elems.formSpinner.classList.remove("visually-hidden"),_elems.formBtn.disabled=!0):(_elems.formBtn.disabled=!1,_elems.formSpinner.classList.add("visually-hidden"))}),initForm=(exports.sendingRequest=sendingRequest,function(){var e=_stateManager.default.categories,r=_triggerManager.default.openCreatingProduct,t=_triggerManager.default.openEditingProduct;r.subscribe(initCreatingForm),t.subscribe(initEditingForm),e.subscribe(renderCategoryOptions)});exports.initForm=initForm;
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.renderPagesButtons=exports.changePage=void 0;var _elems=require("../elems/elems.js"),_stateManager=_interopRequireDefault(require("../managers/stateManager.js"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var changePage=function(e){e=e.target;_stateManager.default.curPage.setValue(e.textContent),_elems.pagesContainer.querySelectorAll(".page-item").forEach(function(e){e.classList.remove("active")}),e.classList.add("active")},createpageBtn=(exports.changePage=changePage,function(e){var t=document.createElement("li"),a=0===e?["btn","page-item","page-link","active"]:["btn","page-item","page-link"];return t.textContent=e+1,(e=t.classList).add.apply(e,a),t.addEventListener("click",changePage),t}),renderPagesButtons=function(){var e=_stateManager.default.pages.getValue();_elems.pagesContainer.innerHTML="",1<e&&new Array(e).fill(0).forEach(function(e,t){_elems.pagesContainer.append(createpageBtn(t))})};exports.renderPagesButtons=renderPagesButtons;
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.sendingRequestTable=exports.renderGoodsRow=exports.renderErrorMessage=exports.initTable=void 0;var _tableController=require("../controllers/tableController.js"),_elems=require("../elems/elems.js"),_utils=require("../utils/utils.js"),_stateManager=_interopRequireDefault(require("../managers/stateManager.js")),_utils2=require("../managers/utils.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var renderGoodsRow=function(e){var t=e.id,r=e.title,n=e.category,e=e.price,s=document.createElement("tr");s.classList.add("table-row","table-goods-item"),s.dataset.id=t,s.innerHTML="\n        <td>".concat(t,"</td>\n            <td>").concat(r,"</td>\n            <td>").concat(n,'</td>\n            <td class="text-end">').concat((0,_utils.currencyFormatRUB)(e),'</td>\n            <td class="d-flex">\n                <button class="btn-table btn-delete">\n                    <svg width="30" height="30">\n                        <use xlink:href="#delete" />\n                    </svg>\n                </button>\n        </td>\n    '),_elems.tableGoodsContainer.append(s),s.addEventListener("click",_tableController.chooseProductItem),s.querySelector(".btn-delete").addEventListener("click",function(){return(0,_tableController.deleteProduct)(s)})},renderErrorMessage=(exports.renderGoodsRow=renderGoodsRow,function(e){_elems.tableErrorContainer.innerHTML='\n        <div class="alert alert-danger w-100" role="alert">\n            <b>'.concat(e.status,":</b> ").concat(e.statusText,"\n        </div>\n    ")}),sendingRequestTable=(exports.renderErrorMessage=renderErrorMessage,function(e){e?(_elems.tableSpinner.classList.remove("visually-hidden"),_elems.creatingProductBtn.disabled=!0):(_elems.creatingProductBtn.disabled=!1,_elems.tableSpinner.classList.add("visually-hidden"))}),renderTable=(exports.sendingRequestTable=sendingRequestTable,function(e){_elems.tableGoodsContainer.innerHTML="",e.forEach(function(e){return renderGoodsRow(e)})}),initTable=function(){(0,_utils2.useEffect)(renderTable,[_stateManager.default.visibleGoods])};exports.initTable=initTable;
//# sourceMappingURL=scripts.min.js.map
